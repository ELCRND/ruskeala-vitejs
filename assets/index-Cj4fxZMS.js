(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const n of s)if(n.type==="childList")for(const r of n.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&i(r)}).observe(document,{childList:!0,subtree:!0});function t(s){const n={};return s.integrity&&(n.integrity=s.integrity),s.referrerPolicy&&(n.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?n.credentials="include":s.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function i(s){if(s.ep)return;s.ep=!0;const n=t(s);fetch(s.href,n)}})();class m{constructor(){this.SLIDER=document.querySelector(".about__slider"),this.WRAPPER=this.SLIDER.querySelector(".about__slider-wrapper"),this.LIST=this.SLIDER.querySelector(".about__slider-list"),this.SLIDES=this.LIST.querySelectorAll(".about__slider-item"),this.PREV=this.SLIDER.querySelector(".about__slider-btn--prev"),this.NEXT=this.SLIDER.querySelector(".about__slider-btn--next"),this.INNER_SLIDER=null,this.INNER_SLIDES=null,this.PAGINATION_CONTAINER=this.SLIDER.querySelector(".about__slider-pagination"),this.PAGINATION_BULLETS=[],this.slideSize=0,this.totalSlides=0,this.currentSlide=0,this.slideSizeInner=0,this.totalSlidesInner=0,this.currentSlideInner=0,this.touchStartX=0,this.touchEndX=0,this.touchStartY=0,this.touchEndY=0,this.minSwipeDistance=50,this.handlePrev=()=>this.prev(),this.handleNext=()=>this.next(),this.handleResize=()=>this.resize(),this.handleTouchStart=e=>this.touchStart(e),this.handleTouchEnd=e=>this.touchEnd(e)}get offset(){return this.slideSize*this.currentSlide}get offsetInner(){return this.slideSizeInner*this.currentSlideInner}get isMobile(){return window.matchMedia("(max-width: 767px)").matches}get isLast(){return this.currentSlide>=this.totalSlides-1&&this.currentSlideInner>=this.totalSlidesInner-1}get isFirst(){return this.currentSlide<=0&&this.currentSlideInner<=0}get isInner(){return this.currentSlideInner<this.totalSlidesInner-1}init(){if(!this.LIST.firstElementChild){console.error("slides not found");return}this.setSize(),this.setTotal(),this.setInnerSlider(),this.setSizeInner(),this.createPagination(),this.on()}setSize(){this.slideSize=this.LIST.firstElementChild.getBoundingClientRect().width}setTotal(){this.totalSlides=this.LIST.childElementCount}setSizeInner(){this.INNER_SLIDER.childElementCount&&(this.slideSizeInner=this.INNER_SLIDER.querySelector("li:not(.inner-slider__item--active)").getBoundingClientRect().width)}setInnerSlider(){this.INNER_SLIDER=this.SLIDES[this.currentSlide].querySelector(".inner-slider__list"),this.INNER_SLIDES=this.INNER_SLIDER.querySelectorAll(".inner-slider__item"),this.totalSlidesInner=this.INNER_SLIDES.length}on(){this.PREV.addEventListener("click",this.handlePrev),this.NEXT.addEventListener("click",this.handleNext),this.LIST.addEventListener("touchstart",this.handleTouchStart,{passive:!0}),this.LIST.addEventListener("touchend",this.handleTouchEnd,{passive:!0}),window.addEventListener("resize",this.handleResize)}off(){this.PREV.removeEventListener("click",this.handlePrev),this.NEXT.removeEventListener("click",this.handleNext),this.LIST.removeEventListener("touchstart",this.handleTouchStart),this.LIST.removeEventListener("touchend",this.handleTouchEnd),window.removeEventListener("resize",this.handleResize)}prev(){if(!this.isFirst){if(this.currentSlideInner>0){this.innerPrev();return}this.currentSlide--,this.setInnerSlider(),this.currentSlideInner=this.INNER_SLIDES.length-1,this.updateInner(),this.update(),this.checkBlockBtns()}}next(){if(!this.isLast){if(this.isInner){this.innerNext();return}this.currentSlide++,this.setInnerSlider(),this.currentSlideInner=0,this.updateInner(),this.update(),this.checkBlockBtns()}}innerNext(){this.currentSlideInner++,this.updateInner(),this.checkBlockBtns()}innerPrev(){this.currentSlideInner--,this.updateInner(),this.checkBlockBtns()}update(){this.LIST.style=`translate: -${this.offset}px 0`,this.SLIDES.forEach((e,t)=>{e.classList.remove("about__slider-item--active"),t==this.currentSlide&&e.classList.add("about__slider-item--active")}),this.setActivePaginationItem()}updateInner(){this.INNER_SLIDER.style=`translate: -${this.offsetInner}px 0`,this.INNER_SLIDES.forEach((e,t)=>{e.classList.remove("inner-slider__item--active"),t==this.currentSlideInner&&e.classList.add("inner-slider__item--active")}),this.setActivePaginationProgress()}checkBlockBtns(){this.PREV.disabled=!1,this.NEXT.disabled=!1,this.isFirst&&(this.PREV.disabled=!0),this.isLast&&(this.NEXT.disabled=!0)}createPagination(){const e=document.querySelectorAll(".inner-slider__list");for(let t=0;t<e.length;t++){const i=document.createElement("div");i.classList.add("pagination__item"),i.setAttribute("data-pagination-item",t);const s=document.createElement("button");s.classList.add("pagination__btn"),s.type="button",s.ariaLabel=t+1+" слайд",this.PAGINATION_BULLETS.push(s),i.appendChild(s);for(let n=0;n<e[t].childElementCount;n++){const r=document.createElement("div");r.classList.add("pagination__progress"),r.setAttribute(`data-pagination-progress${t}`,n),i.appendChild(r)}this.PAGINATION_CONTAINER.appendChild(i)}this.setActivePaginationItem(),this.setActivePaginationProgress(),this.PAGINATION_BULLETS.forEach(t=>t.addEventListener("click",()=>{this.currentSlide=t.parentElement.getAttribute("data-pagination-item"),this.setInnerSlider(),this.currentSlideInner=0,this.updateInner(),this.update(),this.checkBlockBtns()}))}setActivePaginationItem(){this.PAGINATION_CONTAINER.querySelectorAll(".pagination__item").forEach(e=>{e.classList.remove("pagination__item--active"),e.getAttribute("data-pagination-item")==this.currentSlide&&e.classList.add("pagination__item--active")})}setActivePaginationProgress(){this.PAGINATION_CONTAINER.querySelectorAll(".pagination__progress").forEach(e=>{e.classList.remove("pagination__progress--active"),e.getAttribute(`data-pagination-progress${this.currentSlide}`)==this.currentSlideInner&&e.classList.add("pagination__progress--active")})}resize(){this.setSizeInner(),this.updateInner(),this.setSize(),this.update()}touchStart(e){this.touchStartX=e.changedTouches[0].screenX,this.touchStartY=e.changedTouches[0].screenY}touchEnd(e){this.touchEndX=e.changedTouches[0].screenX,this.touchEndY=e.changedTouches[0].screenY,this.swipe()}swipe(){const e=this.touchEndX-this.touchStartX,t=this.touchEndY-this.touchStartY;Math.abs(e)>Math.abs(t)&&Math.abs(e)>this.minSwipeDistance&&(e>0?this.prev():this.next())}}class g{constructor(){this.SLIDER=document.querySelector(".excursions__slider"),this.WRAPPER=this.SLIDER.querySelector(".excursions__slider-wrapper"),this.LIST=this.SLIDER.querySelector(".excursions__slider-list"),this.PREV=this.SLIDER.querySelector(".excursions__slider-btn--prev"),this.NEXT=this.SLIDER.querySelector(".excursions__slider-btn--next"),this.PAGINATION_CONTAINER=this.SLIDER.querySelector(".excursions__slider-pagination"),this.gap=0,this.slideSize=0,this.totalSlides=0,this.visibleSlides=0,this.currentSlide=0,this.touchStartX=0,this.touchEndX=0,this.touchStartY=0,this.touchEndY=0,this.minSwipeDistance=50,this.handlePrev=()=>this.prev(),this.handleNext=()=>this.next(),this.handleResize=()=>this.resize(),this.handlePagination=e=>this.pagination(e),this.handleTouchStart=e=>this.touchStart(e),this.handleTouchEnd=e=>this.touchEnd(e)}get offset(){return(this.slideSize+this.gap)*this.currentSlide}get isMobile(){return window.matchMedia("(max-width: 767px)").matches}get isLast(){return this.currentSlide>=this.totalSlides-1}get isFirst(){return this.currentSlide<=0}init(){if(!this.LIST.firstElementChild){console.error("slides not found");return}this.setSize(),this.setVisibleSlidesCount(),this.setGap(),this.setTotal(),this.on()}setSize(){this.slideSize=this.LIST.firstElementChild.getBoundingClientRect().width}setVisibleSlidesCount(){this.visibleSlides=this.getVisibleHorizontalItems(this.LIST)}setGap(){this.gap=parseInt(window.getComputedStyle(this.LIST).gap)}setTotal(){this.totalSlides=this.LIST.childElementCount}setPaginationBtns(){for(let e=0;e<this.totalSlides;e++)this.PAGINATION_CONTAINER.appendChild(this.createPaginationBtn(e))}createPaginationBtn(e){const t=document.createElement("button");return t.type="button",t.classList.add("excursions__slider-bullet"),t.setAttribute("data-excursions-pagination",e),t.ariaLabel=e+1+" слайд",e==this.currentSlide&&t.classList.add("excursions__slider-bullet--active"),t.addEventListener("click",this.handlePagination),t}on(){this.PREV.addEventListener("click",this.handlePrev),this.NEXT.addEventListener("click",this.handleNext),this.LIST.addEventListener("touchstart",this.handleTouchStart,{passive:!0}),this.LIST.addEventListener("touchend",this.handleTouchEnd,{passive:!0}),window.addEventListener("resize",this.handleResize),this.isMobile&&this.setPaginationBtns()}off(){this.PREV.removeEventListener("click",this.handlePrev),this.NEXT.removeEventListener("click",this.handleNext),this.LIST.removeEventListener("touchstart",this.handleTouchStart),this.LIST.removeEventListener("touchend",this.handleTouchEnd),window.removeEventListener("resize",this.handleResize)}touchStart(e){this.touchStartX=e.changedTouches[0].screenX,this.touchStartY=e.changedTouches[0].screenY}touchEnd(e){this.touchEndX=e.changedTouches[0].screenX,this.touchEndY=e.changedTouches[0].screenY,this.swipe()}swipe(){const e=this.touchEndX-this.touchStartX,t=this.touchEndY-this.touchStartY;Math.abs(e)>Math.abs(t)&&Math.abs(e)>this.minSwipeDistance&&(e>0?this.prev():this.next())}prev(){this.isFirst||(this.currentSlide--,this.update(),this.updatePagination(),this.checkBlockBtns())}next(){this.isLast||(this.currentSlide++,this.update(),this.updatePagination(),this.checkBlockBtns())}update(){this.LIST.style=`translate: -${this.offset}px 0`}resize(){this.setVisibleSlidesCount(),this.setSize(),this.update(),this.isMobile&&!this.PAGINATION_CONTAINER.childElementCount?this.setPaginationBtns():!this.isMobile&&this.PAGINATION_CONTAINER.childElementCount&&this.PAGINATION_CONTAINER.replaceChildren()}pagination(e){const t=e.target.getAttribute("data-excursions-pagination");Number.isNaN(t)||(this.currentSlide=parseInt(t),this.update(),this.updatePagination(),this.checkBlockBtns())}updatePagination(){this.PAGINATION_CONTAINER.childNodes.forEach((e,t)=>{t==this.currentSlide?e.classList.add("excursions__slider-bullet--active"):e.classList.remove("excursions__slider-bullet--active")})}getVisibleHorizontalItems(e){const t=e.getBoundingClientRect();return Array.from(e.children).filter(s=>{const n=s.getBoundingClientRect();return n.left>=t.left&&n.right<=t.right}).length}checkBlockBtns(){this.PREV.disabled=!1,this.NEXT.disabled=!1,this.isFirst&&(this.PREV.disabled=!0),this.isLast&&(this.NEXT.disabled=!0)}}class E{constructor(){this.MENU=document.querySelector(".header__menu"),this.MENU_BTN=document.querySelector(".header__menu-btn"),this.MENU_LINKS=this.MENU.querySelectorAll("a"),this.handleClose=()=>this.close(),this.handleToggle=()=>this.toggle()}open(){this.MENU.classList.add("header__menu--open"),this.MENU_BTN.classList.add("header__menu-btn--open")}close(){this.MENU.classList.remove("header__menu--open"),this.MENU_BTN.classList.aremovedd("header__menu-btn--open")}toggle(){this.MENU.classList.toggle("header__menu--open"),this.MENU_BTN.classList.toggle("header__menu-btn--open")}on(){this.MENU_BTN.addEventListener("click",this.handleToggle),this.MENU_LINKS.forEach(e=>e.addEventListener("click",this.handleClose))}off(){this.MENU_BTN.removeEventListener("click",this.handleClose),this.MENU_BTN.removeEventListener("click",this.handleToggle)}init(){this.on()}}class I{constructor(){this.MENU=document.querySelector(".hero__menu"),this.MENU_BTN=document.querySelector(".hero__menu-btn"),this.handleToggle=()=>this.toggle(),this.handleClose=()=>this.toggle()}toggle(){this.MENU.classList.toggle("hero__menu--close"),this.MENU_BTN.classList.toggle("hero__menu-btn--close")}close(){this.MENU.classList.remove("hero__menu--close"),this.MENU_BTN.classList.remove("hero__menu-btn--close")}on(){this.MENU_BTN.addEventListener("click",this.handleToggle)}off(){this.MENU_BTN.removeEventListener("click",this.handleToggle)}init(){this.on(),window.matchMedia("(max-width: 767px)").matches&&this.handleClose()}}const p=()=>({terminal:{title:"ВОКЗАЛ РУСКЕАЛЬСКОГО ЭКСПРЕССА",description:`На месторождении было заложено пять карьеров, на которых с помощью бурения 
          и закладки пороховых зарядов добывался мрамор четырёх цветов — пепельно-серого, 
          серо-зелёного, белого с серыми прожилками и бело-сине-серого.`,images:["images/hero/gallery/terminal-1.jpg","images/hero/gallery/terminal-2.jpg"]},career:{title:"ИТАЛЬЯНСКИЙ КАРЬЕР",description:`Итальянский карьер в Рускеала — уникальная достопримечательность, обладающая особой энергетикой. 
          
        Бывший блочный Рускеальский карьер, в котором мы с вами находимся, с легкой руки одного из исследователей был назван «Итальянским» именно по той причине, что здесь в 1974-1985 годах при добыче мраморных блоков использовались станки канатного пиления, изначально разработанные в Италии.
          
        Этот грандиозный памятник природы и человеческой деятельности притягивает посетителей со всего мира.`,images:["images/hero/gallery/career-1.jpg","images/hero/gallery/career-2.jpg","images/hero/gallery/career-3.jpg"]},lake:{title:"ОЗЕРО СВЕТЛОЕ",description:`Озеро Светлое является одним из карьеров, где добывали мрамор в Горном Парке Рускеала. 

        Со стороны Итальянского Карьера берег озера Светлое завален отработанной породой мрамора, которая была забракована при добыче. 
        
        Свалка огромных каменных блоков выглядит очень живописно. Они возвышаются над берегом на несколько десятков метров. Все мраморные блоки имеют характерные следы от буровых машин. `,images:["images/hero/gallery/lake-1.webp","images/hero/gallery/lake-2.webp"]},heart:{title:"СЕРДЦЕ РУСКЕАЛА",description:`Большой провал, с высоты птичьего полета действительно напоминающий сердце. 
        Также его называют Рускеальским провалом или Мраморным колоколом.
        
        Собственно сам Провал появился здесь как раз из-за этих активных работ — взрывов на соседних мраморных карьерах, когда подточенная многолетними разработками горная порода, не выдержала, и осыпалась, образовав огромную дыру в земле.
        `,images:["images/hero/gallery/heart-1.jpg","images/hero/gallery/heart-2.jpg","images/hero/gallery/heart-3.webp"]},canyon:{title:"МРАМОРНЫЙ КАНЬОН",description:`В 1765 г. были открыты месторождения мрамора в районе Рускеала. Этот бело-серый камень с оттенками от светло-серого до зеленоватого нашли в поросшем хвойным лесом холме совсем недалеко от живописных Рускеальских водопадов.
        
        Вскоре начинается промышленная добыча мрамора. Рускеальский серый мрамор широко использовался при строительстве Исаакиевского и Казанского соборов, Мраморного, Таврического и Зимнего дворцов Санкт - Петербурга.`,images:["images/hero/gallery/canyon-1.jpg","images/hero/gallery/canyon-2.webp"]},parking:{title:"ПАРКОВКА",description:`В горном парке «Рускеала» открыли новую просторную парковку. Теперь к парку удобно подъезжать и оставлять машину со стороны новой дороги на Рускеалу. Кассы фестиваля будут работать на входе с новой парковки, сообщается в группе «Карельская государственная филармония».

Чтобы попасть на новую приветственную зону, нужно проехать поворот к первой приветственной зоне по улице Лесопильной и свернуть налево на следующем повороте.

На трассе сотрудник парка направит автомобили в нужном направлении. Новую зону большие автобусы не занимают, как следствие, автомобилистам будет удобнее парковаться.`,images:["images/hero/gallery/parking-1.jpg","images/hero/gallery/parking-2.webp"]}});class S{constructor(){this.placesData=p(),this.elements={places:document.querySelectorAll(".hero__place"),placesContainer:document.querySelector(".hero__places"),placesBtn:document.querySelector(".hero__places-btn"),modal:document.querySelector(".hero__modal"),modalBody:document.querySelector(".hero__modal-body"),title:document.querySelector(".hero__modal-title"),description:document.querySelector(".hero__modal-description"),closeBtn:document.querySelector(".hero__modal-close"),viewBtn:document.querySelector(".hero__modal-view"),gallery:document.querySelector(".gallery")},this.state={currentImages:[],currentImageIndex:0,currentPlaceId:null,isModalVisible:!1,isGalleryVisible:!1},this.eventHandlers=new Map,this.onPlaceClick=this.onPlaceClick.bind(this),this.onCloseClick=this.onCloseClick.bind(this),this.onViewClick=this.onViewClick.bind(this),this.onResize=this.onResize.bind(this),this.onEscapeKey=this.onEscapeKey.bind(this),this.onGalleryNext=this.onGalleryNext.bind(this),this.onGalleryPrev=this.onGalleryPrev.bind(this),this.onGalleryClose=this.onGalleryClose.bind(this),this.onPlacesToggleVisible=this.toggleVisiblePlaces.bind(this)}setupGallery(){this.elements.gallery.querySelector(".gallery__close").addEventListener("click",this.onGalleryClose),this.elements.gallery.querySelector(".gallery__prev").addEventListener("click",this.onGalleryPrev),this.elements.gallery.querySelector(".gallery__next").addEventListener("click",this.onGalleryNext),this.elements.gallery.querySelector(".gallery__overlay").addEventListener("click",this.onGalleryClose)}showGallery(e,t=0){this.setupGallery(),this.state.currentImages=e,this.state.currentImageIndex=t,this.state.isGalleryVisible=!0,this.updateGallery(),this.elements.gallery.classList.add("gallery--active"),document.body.style.overflow="hidden"}updateGallery(){const e=this.elements.gallery.querySelector(".gallery__image"),t=this.elements.gallery.querySelector(".gallery__counter");e.src=this.state.currentImages[this.state.currentImageIndex],e.alt=`Фото ${this.state.currentImageIndex+1} из ${this.state.currentImages.length}`,t.textContent=`${this.state.currentImageIndex+1} / ${this.state.currentImages.length}`}onGalleryNext(){this.state.currentImageIndex<this.state.currentImages.length-1&&(this.state.currentImageIndex++,this.updateGallery())}onGalleryPrev(){this.state.currentImageIndex>0&&(this.state.currentImageIndex--,this.updateGallery())}onGalleryClose(){this.elements.gallery.classList.remove("gallery--active"),this.state.isGalleryVisible=!1,document.body.style.overflow="",setTimeout(()=>{this.elements.gallery.style.display="none"},300)}onPlaceClick(e){const i=e.currentTarget.getAttribute("data-id"),s=this.placesData[i];s&&(this.state.currentPlaceId=i,this.showModal(e,s),this.emit("placeClick",e))}onCloseClick(){this.hideModal(),this.emit("modalClose")}onViewClick(){if(this.state.currentPlaceId&&this.placesData[this.state.currentPlaceId].images){const e=this.placesData[this.state.currentPlaceId].images;e.length>0&&(this.elements.gallery.style.display="block",this.showGallery(e,0))}}onResize(){this.onCloseClick()}onEscapeKey(e){e.key==="Escape"&&(this.state.isGalleryVisible?this.onGalleryClose():this.state.isModalVisible&&this.hideModal())}calculateModalPosition(e){const n=window.innerWidth/2,r=window.innerHeight/2,a=e.left+e.width/2,c=e.top+e.height/2;let h,o;return a<n&&c<r?(h=e.right+window.scrollX+10,o=e.top+window.scrollY):a>=n&&c<r?(h=e.left+window.scrollX-500-10,o=e.top+window.scrollY):a<n&&c>=r?(h=e.right+window.scrollX+10,o=e.bottom+window.scrollY-510):(h=e.left+window.scrollX-500-10,o=e.bottom+window.scrollY-510),this.constrainToViewport(h,o,500,510)}constrainToViewport(e,t,i,s){const n=window.innerWidth,r=window.innerHeight,a=10;return{left:Math.max(a,Math.min(e,n-i-a)),top:Math.max(a,Math.min(t,r-s-a))}}showModal(e,t){const i=e.target.getBoundingClientRect(),{left:s,top:n}=this.calculateModalPosition(i);this.elements.modal.style.top=`${n}px`,this.elements.modal.style.left=`${s}px`,this.elements.title.textContent=t.title,this.elements.description.innerText=t.description,this.elements.viewBtn.style.display=t.images?.length>0?"flex":"none",this.elements.modal.style.display="block",this.state.isModalVisible=!0}hideModal(){this.elements.modal.style.display="none",this.state.isModalVisible=!1,this.state.currentPlaceId=null}toggleVisiblePlaces(){this.elements.placesBtn.classList.toggle("hero__places-btn--close"),this.elements.placesContainer.classList.toggle("hero__places--close")}on(e,t){this.eventHandlers.has(e)||this.eventHandlers.set(e,new Set),this.eventHandlers.get(e).add(t)}off(e,t){if(this.eventHandlers.has(e)){const i=this.eventHandlers.get(e);i.delete(t),i.size===0&&this.eventHandlers.delete(e)}}emit(e,...t){this.eventHandlers.has(e)&&this.eventHandlers.get(e).forEach(i=>i(...t))}init(){this.elements.places.forEach(e=>{e.addEventListener("click",this.onPlaceClick),e.getAttribute("data-id")==="terminal"&&e.click()}),this.elements.closeBtn.addEventListener("click",this.onCloseClick),this.elements.viewBtn.addEventListener("click",this.onViewClick),this.elements.placesBtn.addEventListener("click",this.onPlacesToggleVisible),window.addEventListener("resize",this.onResize),document.addEventListener("keydown",this.onEscapeKey),window.matchMedia("(max-width: 767px)").matches&&(this.onCloseClick(),this.onPlacesToggleVisible())}destroy(){this.elements.places.forEach(e=>{e.removeEventListener("click",this.onPlaceClick)}),this.elements.closeBtn.removeEventListener("click",this.onCloseClick),this.elements.viewBtn.removeEventListener("click",this.onViewClick),window.removeEventListener("resize",this.onResize),document.removeEventListener("keydown",this.onEscapeKey),this.elements.gallery&&this.elements.gallery.remove(),this.eventHandlers.clear(),this.hideModal(),this.state.isGalleryVisible&&this.onGalleryClose()}}class _{constructor(e){this.CONTAINER=e.querySelector(".custom-select"),this.BTN=this.CONTAINER.querySelector(".custom-select__btn"),this.INPUT=this.CONTAINER.querySelector(".custom-select__input"),this.DROPDOWN=this.CONTAINER.querySelector(".custom-select__dropdown"),this.ITEMS=this.CONTAINER.querySelectorAll(".custom-select__item"),this.TEXT=this.CONTAINER.querySelector(".custom-select__text"),this.FORM=e,this.handleToggle=()=>this.toggle(),this.init()}init(){this.BTN.addEventListener("click",this.handleToggle),this.ITEMS.forEach(e=>{e.addEventListener("click",()=>this.selectItem(e))}),this.FORM.addEventListener("click",e=>{this.CONTAINER.contains(e.target)||this.close()})}toggle(){this.CONTAINER.classList.toggle("custom-select--open")}open(){this.CONTAINER.classList.add("custom-select--open")}close(){this.CONTAINER.classList.remove("custom-select--open")}selectItem(e){const t=e.dataset.value,i=e.textContent;this.INPUT.value=t,this.TEXT.textContent=i,this.ITEMS.forEach(s=>s.classList.remove("custom-select__item--active")),e.classList.add("custom-select__item--active"),this.close(),this.INPUT.dispatchEvent(new Event("change",{bubbles:!0}))}getValue(){return this.INPUT.value}}class N{constructor(e){this.CONTAINER=e.querySelector(".ticket__counter"),this.DECREMENT_BTN=this.CONTAINER.querySelector(".ticket__counter-btn--decrement"),this.INCREMENT_BTN=this.CONTAINER.querySelector(".ticket__counter-btn--increment"),this.INPUT=this.CONTAINER.querySelector(".ticket__counter-input"),this.handleDecrement=()=>this.decrement(),this.handleIncrement=()=>this.increment(),this.handleValidate=()=>this.validate(),this.handleInput=()=>this.validate(!0),this.init()}init(){this.DECREMENT_BTN.addEventListener("click",this.handleDecrement),this.INCREMENT_BTN.addEventListener("click",this.handleIncrement),this.INPUT.addEventListener("change",this.handleValidate),this.INPUT.addEventListener("input",this.handleInput)}decrement(){let e=parseInt(this.INPUT.value)||1;e<=1||(e--,this.INPUT.value=e,this.INPUT.dispatchEvent(new Event("change",{bubbles:!0})))}increment(){let e=parseInt(this.INPUT.value)||1;const t=parseInt(this.INPUT.max)||99;e>=t||(e++,this.INPUT.value=e,this.INPUT.dispatchEvent(new Event("change",{bubbles:!0})))}validate(e){let t=parseInt(this.INPUT.value)||1;const i=parseInt(this.INPUT.min)||1,s=parseInt(this.INPUT.max)||99;t<i&&(t=i),t>s&&(t=s),this.INPUT.value=t,e&&this.INPUT.dispatchEvent(new Event("change",{bubbles:!0}))}getValue(){return parseInt(this.INPUT.value)||1}}const d={adult:500,children:250};class u{constructor(e,t){this.form=document.querySelector(e),this.select=new _(this.form),this.counter=new N(this.form),this.dateInput=this.form.querySelector(".ticket__form-date"),this.priceElement=this.form.querySelector(".ticket__price"),this.submitBtn=this.form.querySelector(".ticket__submit-btn"),this.REMOVE_BTN=document.querySelector(".ticket__form-remove"),this.handleUpdatePrice=()=>this.updatePrice(),this.handleValidateDate=()=>this.updatePrice(),this.handleSubmit=i=>this.submit(i),this.handleRemove=t,this.init()}get domElement(){return this.form}init(){this.submitBtn.disabled=!1,this.submitBtn.classList.remove("ticket__submit-btn--submited"),this.submitBtn.textContent="Добавить в корзину",this.select.INPUT.addEventListener("change",this.handleUpdatePrice),this.counter.INPUT.addEventListener("change",this.handleUpdatePrice),this.dateInput.addEventListener("change",this.handleValidateDate),this.REMOVE_BTN.addEventListener("click",this.handleRemove),this.form.addEventListener("submit",this.handleSubmit),this.updatePrice(),this.validateDate()}updatePrice(){const e=this.select.getValue(),t=this.counter.getValue(),i=d[e]*t;this.priceElement.textContent=`${i}.00 ₽`}validateDate(){const e=new Date(this.dateInput.value),t=new Date;t.setHours(0,0,0,0),e<t?this.dateInput.setCustomValidity("Дата не может быть в прошлом"):this.dateInput.setCustomValidity("")}submit(e){if(e.preventDefault(),!this.form.checkValidity()){this.form.reportValidity();return}const t=this.getFormData();console.log(t),this.updatePrice(),this.showSuccessMessage()}getFormData(){return{type:this.select.getValue(),typeName:this.select.TEXT.textContent,date:this.dateInput.value||new Date().toLocaleString("ru-RU",{year:"numeric",month:"long",day:"numeric"}),quantity:this.counter.getValue(),price:d[this.select.getValue()],total:d[this.select.getValue()]*this.counter.getValue()}}showSuccessMessage(){this.submitBtn.textContent="Добавлено!",this.submitBtn.classList.add("ticket__submit-btn--submited"),this.submitBtn.disabled=!0}}class v{constructor(){this.FORM_CONTAINER=document.querySelector(".ticket__form-container"),this.ADD_MORE=document.querySelector(".ticket__form-add"),this.FORM_LIST=new Map,this.handleRemove=e=>this.remove(e),this.initialForm=new u(".ticket__form",this.handleRemove),this.formCount=1,this.handleAddMore=e=>this.addMore(e)}init(){this.FORM_LIST.set(this.initialForm.domElement.id,this.initialForm),this.ADD_MORE.addEventListener("click",this.handleAddMore)}addMore(){const e=this.deepCloneClassNames(this.initialForm.domElement.cloneNode(!0),this.formCount+=1);e.reset(),this.FORM_CONTAINER.prepend(e);const t=new u(`#${e.id}`,this.handleRemove);this.FORM_LIST.set(t.domElement.id,t)}deepCloneClassNames(e,t){return[...e.children].forEach(i=>{i.id&&(i.id+=`--${t}`),i.hasChildNodes()&&this.deepCloneClassNames(i,t)}),e.classList.add(e.classList[0]+`--${t}`),e.tagName==="LABEL"&&e.htmlFor&&(e.htmlFor+=`--${t}`),e}remove(e){const t=e.target.parentElement.id;this.FORM_LIST.delete(t),document.getElementById(t).remove()}}document.addEventListener("DOMContentLoaded",()=>{new E().init(),new I().init(),new S().init(),new v().init(),new g().init(),new m().init()});
